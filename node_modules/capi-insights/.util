"use strict";const os=require("os"),fs=require("fs"),spawn=require("child_process").spawn,exec=require("child_process").exec,execSync=require("child_process").execSync,util=require("util");let _platform=process.platform;const _linux="linux"===_platform,_darwin="darwin"===_platform,_windows="win32"===_platform,_freebsd="freebsd"===_platform,_openbsd="openbsd"===_platform,_netbsd="netbsd"===_platform;let _cores=0,wmicPath="",codepage="";const execOptsWin={windowsHide:!0,maxBuffer:2048e4,encoding:"UTF-8",env:util._extend({},process.env,{LANG:"en_US.UTF-8"})};function toInt(e){let t=parseInt(e,10);return isNaN(t)&&(t=0),t}function isFunction(e){return e&&"[object Function]"==={}.toString.call(e)}function unique(e){let t=[],n={};for(let r=0;r<e.length;r++){let s=Object.keys(e[r]);s.sort(function(e,t){return e-t});let o="";for(let t=0;t<s.length;t++)o+=JSON.stringify(s[t]),o+=JSON.stringify(e[r][s[t]]);({}).hasOwnProperty.call(n,o)||(t.push(e[r]),n[o]=!0)}return t}function sortByKey(e,t){return e.sort(function(e,n){let r="",s="";return t.forEach(function(t){r+=e[t],s+=n[t]}),r<s?-1:r>s?1:0})}function cores(){return 0===_cores&&(_cores=os.cpus().length),_cores}function getValue(e,t,n,r){n=n||":",t=t.toLowerCase(),r=r||!1;for(let s=0;s<e.length;s++){let o=e[s].toLowerCase().replace(/\t/g,"");if(r&&(o=o.trim()),o.startsWith(t)){const t=e[s].split(n);return t.length>=2?(t.shift(),t.join(n).trim()):""}}return""}function decodeEscapeSequence(e,t){return t=t||16,e.replace(/\\x([0-9A-Fa-f]{2})/g,function(){return String.fromCharCode(parseInt(arguments[1],t))})}function detectSplit(e){let t="",n=0;return e.split("").forEach(e=>{e>="0"&&e<="9"?1===n&&n++:(0===n&&n++,1===n&&(t+=e))}),t}function parseTime(e,t){t=t||"";let n=0,r=0,s=detectSplit(e=e.toUpperCase()),o=e.split(s);if(o.length>=2){o[2]&&(o[1]+=o[2]);let e=o[1]&&o[1].toLowerCase().indexOf("pm")>-1||o[1].toLowerCase().indexOf("p.m.")>-1||o[1].toLowerCase().indexOf("p. m.")>-1||o[1].toLowerCase().indexOf("n")>-1||o[1].toLowerCase().indexOf("ch")>-1||o[1].toLowerCase().indexOf("Ã¶s")>-1||t&&o[1].toLowerCase().indexOf(t)>-1;return n=parseInt(o[0],10),r=parseInt(o[1],10),("0"+(n=e&&n<12?n+12:n)).substr(-2)+":"+("0"+r).substr(-2)}}function parseDateTime(e,t){const n={date:"",time:""};let r=((t=t||{}).dateFormat||"").toLowerCase(),s=t.pmDesignator||"";const o=e.split(" ");if(o[0]){if(o[0].indexOf("/")>=0){const t=o[0].split("/");if(3===t.length)if(4===t[0].length)n.date=t[0]+"-"+("0"+t[1]).substr(-2)+"-"+("0"+t[2]).substr(-2);else if(2===t[2].length)r.indexOf("/d/")>-1||r.indexOf("/dd/"),n.date="20"+t[2]+"-"+("0"+t[1]).substr(-2)+"-"+("0"+t[0]).substr(-2);else{(e.toLowerCase().indexOf("pm")>-1||e.toLowerCase().indexOf("p.m.")>-1||e.toLowerCase().indexOf("p. m.")>-1||e.toLowerCase().indexOf("am")>-1||e.toLowerCase().indexOf("a.m.")>-1||e.toLowerCase().indexOf("a. m.")>-1||r.indexOf("/d/")>-1||r.indexOf("/dd/")>-1)&&0!==r.indexOf("dd/")?n.date=t[2]+"-"+("0"+t[0]).substr(-2)+"-"+("0"+t[1]).substr(-2):n.date=t[2]+"-"+("0"+t[1]).substr(-2)+"-"+("0"+t[0]).substr(-2)}}if(o[0].indexOf(".")>=0){const e=o[0].split(".");3===e.length&&(r.indexOf(".d.")>-1||r.indexOf(".dd.")>-1?n.date=e[2]+"-"+("0"+e[0]).substr(-2)+"-"+("0"+e[1]).substr(-2):n.date=e[2]+"-"+("0"+e[1]).substr(-2)+"-"+("0"+e[0]).substr(-2))}if(o[0].indexOf("-")>=0){const e=o[0].split("-");3===e.length&&(n.date=e[0]+"-"+("0"+e[1]).substr(-2)+"-"+("0"+e[2]).substr(-2))}}if(o[1]){o.shift();let e=o.join(" ");n.time=parseTime(e,s)}return n}function parseHead(e,t){let n=t>0,r=1,s=0,o=0,i=[];for(let c=0;c<e.length;c++)r<=t?(/\s/.test(e[c])&&!n&&(o=c-1,i.push({from:s,to:o+1,cap:e.substring(s,o+1)}),s=o+2,r++),n=" "===e[c]):(!/\s/.test(e[c])&&n&&(s<(o=c-1)&&i.push({from:s,to:o,cap:e.substring(s,o)}),s=o+1,r++),n=" "===e[c]);o=1e3,i.push({from:s,to:o,cap:e.substring(s,o)});let c=i.length;for(var a=0;a<c;a++)0===i[a].cap.replace(/\s/g,"").length&&a+1<c&&(i[a].to=i[a+1].to,i[a].cap=i[a].cap+i[a+1].cap,i.splice(a+1,1),c-=1);return i}function findObjectByKey(e,t,n){for(let r=0;r<e.length;r++)if(e[r][t]===n)return r;return-1}function getWmic(){if("Windows_NT"===os.type()&&!wmicPath&&(wmicPath=process.env.WINDIR+"\\system32\\wbem\\wmic.exe",!fs.existsSync(wmicPath)))try{const e=execSync("WHERE WMIC").toString().split("\r\n");wmicPath=e&&e.length?e[0]:"wmic"}catch(e){wmicPath="wmic"}return wmicPath}function wmic(e,t){return t=t||execOptsWin,new Promise(n=>{process.nextTick(()=>{try{exec(getWmic()+" "+e,t,function(e,t){n(t,e)}).stdin.end()}catch(e){n("",e)}})})}function getVboxmanage(){return _windows?process.env.VBOX_INSTALL_PATH||process.env.VBOX_MSI_INSTALL_PATH+'\\VBoxManage.exe" ':"vboxmanage"}function powerShell(e){let t="";return new Promise(n=>{process.nextTick(()=>{try{const r=spawn("powershell.exe",["-NoLogo","-InputFormat","Text","-NoExit","-ExecutionPolicy","Unrestricted","-Command","-"],{stdio:"pipe"});if(r&&!r.pid&&r.on("error",function(){n(t)}),r&&r.pid){r.stdout.on("data",function(e){t+=e.toString("utf8")}),r.stderr.on("data",function(){r.kill(),n(t)}),r.on("close",function(){r.kill(),n(t)}),r.on("error",function(){r.kill(),n(t)});try{r.stdin.write(e+os.EOL),r.stdin.write("exit"+os.EOL),r.stdin.end()}catch(e){r.kill(),n(t)}}else n(t)}catch(e){n(t)}})})}function getCodepage(){if(_windows){if(!codepage)try{const e=execSync("chcp").toString().split("\r\n")[0].split(":");codepage=e.length>1?e[1].replace(".",""):""}catch(e){codepage="437"}return codepage}if(_linux||_darwin||_freebsd||_openbsd||_netbsd){if(!codepage)try{const e=execSync("echo $LANG").toString().split("\r\n")[0].split(".");(codepage=e.length>1?e[1].trim():"")||(codepage="UTF-8")}catch(e){codepage="UTF-8"}return codepage}}function isRaspberry(){let e=[];try{e=fs.readFileSync("/proc/cpuinfo",{encoding:"utf8"}).split("\n")}catch(e){return!1}const t=getValue(e,"hardware");return t&&["BCM2708","BCM2709","BCM2710","BCM2835","BCM2837B0"].indexOf(t)>-1}function isRaspbian(){let e=[];try{e=fs.readFileSync("/etc/os-release",{encoding:"utf8"}).split("\n")}catch(e){return!1}const t=getValue(e,"id");return t&&t.indexOf("raspbian")>-1}function execWin(e,t,n){n||(n=t,t=execOptsWin),exec("chcp 65001 > nul && cmd /C "+e+" && chcp "+codepage+" > nul",t,function(e,t){n(e,t)})}function darwinXcodeExists(){const e=fs.existsSync("/Library/Developer/CommandLineTools/usr/bin/"),t=fs.existsSync("/Applications/Xcode.app/Contents/Developer/Tools"),n=fs.existsSync("/Library/Developer/Xcode/");return e||n||t}function nanoSeconds(){const e=process.hrtime();return Array.isArray(e)&&2===e.length?1e9*+e[0]+ +e[1]:0}function countUniqueLines(e,t){t=t||"";const n=[];return e.forEach(e=>{e.startsWith(t)&&-1===n.indexOf(e)&&n.push(e)}),n.length}function countLines(e,t){t=t||"";const n=[];return e.forEach(e=>{e.startsWith(t)&&n.push(e)}),n.length}function sanitizeShellString(e){let t=e;return t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/>/g,"")).replace(/</g,"")).replace(/\*/g,"")).replace(/\?/g,"")).replace(/\[/g,"")).replace(/\]/g,"")).replace(/\|/g,"")).replace(/\`/g,"")).replace(/\$/g,"")).replace(/;/g,"")).replace(/&/g,"")).replace(/\)/g,"")).replace(/\(/g,"")).replace(/\$/g,"")).replace(/#/g,"")).replace(/\\/g,"")).replace(/\t/g,"")).replace(/\n/g,"")).replace(/\"/g,"")}function noop(){}exports.toInt=toInt,exports.execOptsWin=execOptsWin,exports.getCodepage=getCodepage,exports.execWin=execWin,exports.isFunction=isFunction,exports.unique=unique,exports.sortByKey=sortByKey,exports.cores=cores,exports.getValue=getValue,exports.decodeEscapeSequence=decodeEscapeSequence,exports.parseDateTime=parseDateTime,exports.parseHead=parseHead,exports.findObjectByKey=findObjectByKey,exports.getWmic=getWmic,exports.wmic=wmic,exports.darwinXcodeExists=darwinXcodeExists,exports.getVboxmanage=getVboxmanage,exports.powerShell=powerShell,exports.nanoSeconds=nanoSeconds,exports.countUniqueLines=countUniqueLines,exports.countLines=countLines,exports.noop=noop,exports.isRaspberry=isRaspberry,exports.isRaspbian=isRaspbian,exports.sanitizeShellString=sanitizeShellString;